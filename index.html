<!--[Template] DFP Quartiles Flex Frame: Video (Mobile-InApp)-->

<script type="text/javascript" src="mraid.js"></script>
<script type="text/javascript" src="//fast.fonts.net/jsapi/4221a460-4ed2-4039-a07f-d1f4a2739cad.js"></script>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>


<div id="container" class="container">
  <div class="flex-frame">
    <div id="media-container" class="media-container">
      <div class="media-content">
        <a target="_blank" href="%%CLICK_URL_UNESC%%%%DEST_URL%%">
        <div id="title1" class="title">[%Headline%]</div>
        <div class="summary">[%Summary%]</div>
        <div onclick="eventTracker.generalEventTrack('clickURL', 'cta', '%%CLICK_URL_UNESC%%%%DEST_URL_UNESC%%'), selectFunction()" class="cta">[%CTA%]</div>
        </a>
      </div>
      <div class="tablet-action-item-logo">
        <div class="logo">
          <img onclick="eventTracker.generalEventTrack('clickURL', 'logo', '%%CLICK_URL_UNESC%%%%DEST_URL_UNESC%%')" class="logo-std" src="[%Logo%]" />
          <img onclick="eventTracker.generalEventTrack('clickURL', 'logo', '%%CLICK_URL_UNESC%%%%DEST_URL_UNESC%%')" class="logo-hi-res" src="[%LogoHiRes%]"/>
        </div>
      </div>
        
      
      <div class="video video-content">
      #%NATIVE_VIDEO_WRAPPER%# 
      </div>
      


      <div class="video-cover"></div>  
      <div class="gradient"></div>
     <div class="img-container">

    </div>

  </div>
  <canvas class="js-canvas"></canvas> 
</div>
 

<!--Removed Script<script type="text/javascript" src="https://static01.nyt.com/ads/dfp_native_ads/javascript/canvas-video-player-patched.js"></script>
-->

<script type="text/javascript" id="update-10.4.2019">

var video,replay,adVideo;

setTimeout(function(){

  video = document.querySelector('video');
  replay = document.querySelector("img[src='https://www.gstatic.com/dfp/native/replay.png']"); 
  adVideo = document.getElementsByClassName('ad-video')[0]; 

  video.addEventListener('play', function(){
  document.getElementsByClassName("title")[0].style.display = "none"; 
  document.getElementsByClassName("summary")[0].style.display = "none";
  });

  video.addEventListener('pause', function(){
  document.getElementsByClassName("title")[0].style.display = "block"; 
  document.getElementsByClassName("summary")[0].style.display = "block";    
  });


  runSIXnine(); 


}, 3000);


var VideoSize = [%VideoSize%];

function runSIXnine(){
   if (VideoSize === "16x9") {
     styles();
      video.onended = function(){
        myFunction();
    }
  } 
  console.log("sunSIXnine fire!!")
}


function styles(){
  replay.style.top =  "-65px"; 
  replay.style.left = "15px";
  
  adVideo.style.top = "50%";
  adVideo.style.bottom = "50%";
  adVideo.style.position = "absolute";
  console.log("styels function is working"); 
  }


function myFunction() {
  setInterval(function(){   
    var cover = document.getElementById("video-thumbnail-image");
	
  cover.style.zIndex = "0";
	cover.style.width = "auto";
	cover.style.height = "100%";
	cover.style.position = "fixed";
	cover.style.left = "0px";
	cover.style.top = "0px";
  }, 0);
 console.log("myFunction is working"); 
}



// Native Tracking Code //

"use strict";

// Native Tracking Code --------------------------------------------- //

var eventTracker = function () {
var ETLink = "https://et.nytimes.com/?subject=dfp-ad-events&dfp_creativeid=%ecid!&dfp_lineitemid=%eaid!&dfp_orderid=%ebuy!&dfp_viewport=%%PATTERN:vp%%&pageviewid=%%PATTERN:page_view_id%%&dfp_pos=%%PATTERN:pos%%&dfp_prop=%%PATTERN:prop%%";

var slideCSSClass = "slide";
var slideNavType = "slideURL";
var slideClickType = "clickURL";

//Slide navigation control
var slidesNum = document.getElementsByClassName(slideCSSClass).length;
var currentSlide = 1;

/*
* function to call the Nytimes ET pixel link for the slide templte
* @param curr - current slide
* @param type - event type 
*/
var ETSlideCall = function ETSlideCall(type, curr) {
var next = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";

var trackingLink = ETLink + "&dfp_event_type=" + type + "&dfp_event_location=slide-" + curr;
if (next != "") {
trackingLink += "_" + "slide-" + next;
}
document.createElement('img').src = trackingLink;
};
//Public functions
return {
/*
*Next slide function - Updates the current slide and call the ET function
*/
nextSlideET: function nextSlideET() {
var prevSlide = currentSlide;
if (currentSlide >= slidesNum) {
currentSlide = 1;
} else {
currentSlide++;
}
ETSlideCall(slideNavType, prevSlide, currentSlide);
},

/*
* Previous slide function - Updates the current slide and call the ET function
*/
prevSlideET: function prevSlideET() {
var prevSlide = currentSlide;
if (currentSlide <= 1) {
currentSlide = slidesNum;
} else {
currentSlide--;
}
ETSlideCall(slideNavType, prevSlide, currentSlide);
},

/*
* Click slide function - Redirects to target url
* @param tag - HTML anchor tag the called this func. 
* @param next - sums up to the current slide number 
* usage: <a href="link-to-the-ad-redirect" onclick="eventTracker.slideClickET(this)">
*/
slideClickET: function slideClickET(tag) {
var next = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

// console.log("this", tag);
event.preventDefault();
var slideTrack = currentSlide;
if (next) {
slideTrack = currentSlide == slidesNum ? 1 : currentSlide + 1;
}
ETSlideCall(slideClickType, slideTrack);
var url = tag.href;
window.open(url, '_blank');
},

/*
* General event tracker call
* @param eventType - event type to be tracked
* @param eventLocation - event location to be tracked
* @param redirectLink - Link to ad page to be called after eventtracker
*/

generalEventTrack: function generalEventTrack(eventType, eventLocation) {
var redirectLink = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";

event.preventDefault();
var trackingLink = ETLink + "&dfp_event_type=" + eventType + "&dfp_event_location=" + eventLocation;
document.createElement('img').src = trackingLink;
if (redirectLink != "") {
window.open(redirectLink, '_blank');
}
},


setETLink: function setETLink(link) {
ETLink = link;
},

setSlideCSSClass: function setSlideCSSClass(cssClass) {
slideCSSClass = cssClass;
slidesNum = document.getElementsByClassName(slideCSSClass).length;
},
setSlideClicktype: function setSlideClicktype(type) {
slideClickType = type;
},

setSlideNavType: function setSlideNavType(type) {
slideNavType = type;
}
};
}();


 // End of Native Tracking Code // 


</script>

<!--Removed JS for context bullet
<script type="text/javascript">
(function() {
  var header = document.getElementsByClassName('context-bullet')[0];
  var headerContent = document.getElementsByClassName('context-bullet-content')[0];
  var noHeaderPages = ['hp', 'int', 'art', 'art,rev', 'art,oak'];
  var pageType = '%%PATTERN:typ%%';
  var pagePos = '%%PATTERN:pos%%';
  var prop = '%%PATTERN:prop%%';

  if (pagePos === 'top') {
    if (noHeaderPages.indexOf(pageType) > -1) {
      header.style.display = 'none';
    } else {
      headerContent.style.display = 'none';
    }
  } else if (prop === 'itabapp') {
    header.style.display = 'table';
  } else if (pageType === 'hp') {
    header.style.display = 'none';
  } 
})();
</script>
-->

<script type="text/javascript">
(function() {
// Hide gradient if necessary
var toggleGradient = [%ToggleGradient%];
var gradients = [].slice.call(document.getElementsByClassName('gradient'));
if (toggleGradient > 0) {
  gradients.forEach(function(el) {
    el.style.display = 'none';
  });
}
})();
</script>
<div style="display: none;">
[%CustomTracking%]
</div>
<div id="impression-pixel" class="impression-tracker">
  <img src="[%ImpressionPixel%]" width="1" height="1" border="0" />
</div>
<div id="impression-pixel-2" class="impression-tracker">
  <img src="[%ImpressionPixel2%]" width="1" height="1" border="0" />
</div>
<script type="text/javascript">
parent.postMessage({exclusive: [%Exclusivity%], type: '[%ExclusivityType%]', div:'%%PATTERN:div%%'},'*');
</script>
